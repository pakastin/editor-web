!function(){"use strict";var t,e=redom.el,i=redom.mount,n=9,u=13,r=[],o=[],s=new Worker("js/worker.js"),a=function(i){function o(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];for(var n=[],u=0;u<t;u++)Array.prototype.push.apply(n,e);return n.join("")}var s=this;this.el=e(".editor",this.input=e("textarea",{autocapitalize:!1,autocomplete:!1,autofocus:!0,spellcheck:!1,value:["<!DOCTYPE html>","<html>","\t<head>",'\t\t<meta charset="utf-8">',"\t\t<title></title>","\t\t<style>","\t\t\t","\t\t</style>","\t</head>","\t<body>","\t\t","\t</body>","</html>"].join("\n")}),this.output=e(".output"),this.preview=e("iframe.preview",{style:{background:"#fff",border:0,display:"none"}})),this.input.selectionStart=this.input.selectionEnd=118,this.render(),r.push(this.input.value),this.input.oncopy=function(t){for(var e="",i=s.input.value.slice(s.input.selectionStart,s.input.selectionEnd),n=0;n<i.length;n++)"\t"===i[n]?(e+=" ",e+=" "):e+=i[n];t.clipboardData.setData("text/plain",e),t.preventDefault(),console.log(e)},this.input.addEventListener("input",function(e){s._validatedInput?(t&&clearTimeout(t),t=setTimeout(function(){r[r.length-1]!==s.input.value&&r.push(s.input.value)},100),s.render()):(console.log("prevented"),e.preventDefault(),s.input.value=s._value),s._validatedInput=!1}),this.input.onmousemove=function(t){s.input.style.cursor=""},this.input.onmouseup=function(t){s.render()},this.input.onkeydown=function(t){var e=t.which;if(s.input.style.cursor="none",s._validatedInput=!0,e===n){t.preventDefault();var i=s.input.value,r=s.input.selectionStart;s.input.value=i.slice(0,r)+"\t"+i.slice(r),s.input.selectionStart=s.input.selectionEnd=r+1}else if(e===u){t.preventDefault();for(var a=s.input.value,p=s.input.selectionStart,l=s.input.selectionEnd,h=0,c=p-1;c>=0&&"\n"!==a[c];c--)"\t"===a[c]?h++:" "===a[c]&&" "===a[c+1]?h++:h=0;s.input.value=a.slice(0,p)+"\n"+o(h,"\t")+a.slice(l),s.input.selectionStart=s.input.selectionEnd=p+h+1}s.render()},this.input.onkeyup=function(t){s._value=s.input.value,requestAnimationFrame(function(){return s.render()})},window.addEventListener("keydown",function(t){switch(t.which){case 51:(t.ctrlKey||t.metaKey)&&(t.preventDefault(),s.fullPreview());break;case 50:(t.ctrlKey||t.metaKey)&&(t.preventDefault(),s.showPreview());break;case 49:(t.ctrlKey||t.metaKey)&&(t.preventDefault(),s.hidePreview());break;case 82:(t.ctrlKey||t.metaKey)&&(t.preventDefault(),s.refreshPreview());break;case 83:(t.ctrlKey||t.metaKey)&&(t.preventDefault(),s.showPreview());break;case 90:(t.ctrlKey||t.metaKey)&&(t.preventDefault(),t.shiftKey?s.redo():r.length&&s.undo());break;case 88:case 89:(t.ctrlKey||t.metaKey)&&(t.preventDefault(),r.length&&(console.log("undo"),s.undo()))}})};a.prototype.undo=function(){if(r.length){var t=r.pop();o.push(t),r.length&&this.input.value===t?this.undo():this.input.value=t,0===r.length&&r.push(t),this.render()}},a.prototype.redo=function(){if(o.length){var t=o.pop();r.push(t),o.length&&this.input.value===t?this.redo():this.input.value=t,this.render()}},a.prototype.render=function(){var t=this.input.value;s.postMessage({type:"highlight",data:t})},a.prototype.refreshPreview=function(){var t=p.input.value;this.preview.src="data:text/html;charset=utf-8,"+encodeURIComponent(t)},a.prototype.hidePreview=function(){this.preview.style.display="none",this.preview.style.width="",this.input.style.width="",this.output.style.width="",this.input.focus()},a.prototype.showPreview=function(){var t=p.input.value;this.preview.src="data:text/html;charset=utf-8,"+encodeURIComponent(t),this.preview.style.display="",this.preview.style.width="",this.input.style.width="50%",this.output.style.width="50%"},a.prototype.fullPreview=function(){var t=p.input.value;this.preview.src="data:text/html;charset=utf-8,"+encodeURIComponent(t),this.preview.style.display="",this.preview.style.width="100%",this.input.style.width="100%",this.output.style.width="100%"};var p=new a;s.addEventListener("message",function(t){var e=t.data,i=e.type,n=e.data;"highlight"===i&&requestAnimationFrame(function(){p.output.innerHTML=n,p.input.style.height=p.output.clientHeight+"px",p.input.scrollTop=0})}),i(document.body,p)}();
!function(){"use strict";var t,e=redom.el,i=redom.mount,n=9,u=13,o=[],s=[],a=new Worker("js/worker.js"),r=function(i){function s(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];for(var n=[],u=0;u<t;u++)Array.prototype.push.apply(n,e);return n.join("")}var a=this;this.el=e(".editor",this.input=e("textarea",{autocapitalize:!1,autocomplete:!1,autofocus:!0,spellcheck:!1,value:["<!DOCTYPE html>","<html>","\t<head>",'\t\t<meta charset="utf-8">',"\t\t<title></title>","\t\t<style>","\t\t\t","\t\t</style>","\t</head>","\t<body>","\t\t","\t</body>","</html>"].join("\n")}),this.output=e(".output"),this.preview=e("iframe.preview",{style:{background:"#fff",border:0,display:"none"}}),this.previewButton=e(".preview-button",this.previewButtonIcon=e("i.fi-eye"))),this.input.selectionStart=this.input.selectionEnd=118,this.render(),o.push(this.input.value),this.previewButton.onclick=function(t){return a.togglePreview()},this.input.oncopy=function(t){for(var e="",i=a.input.value.slice(a.input.selectionStart,a.input.selectionEnd),n=0;n<i.length;n++)"\t"===i[n]?(e+=" ",e+=" "):e+=i[n];t.clipboardData.setData("text/plain",e),t.preventDefault(),console.log(e)},this.input.addEventListener("input",function(e){a._validatedInput?(t&&clearTimeout(t),t=setTimeout(function(){o[o.length-1]!==a.input.value&&o.push(a.input.value)},100),a.render()):(console.log("prevented"),e.preventDefault(),a.input.value=a._value),a._validatedInput=!1}),this.input.onmouseup=function(t){a.render()},this.input.onkeydown=function(t){var e=t.which;if(a._validatedInput=!0,e===n){t.preventDefault();var i=a.input.value,o=a.input.selectionStart;a.input.value=i.slice(0,o)+"\t"+i.slice(o),a.input.selectionStart=a.input.selectionEnd=o+1}else if(e===u){t.preventDefault();for(var r=a.input.value,l=a.input.selectionStart,p=a.input.selectionEnd,c=0,h=l-1;h>=0&&"\n"!==r[h];h--)"\t"===r[h]?c++:" "===r[h]&&" "===r[h+1]?c++:c=0;a.input.value=r.slice(0,l)+"\n"+s(c,"\t")+r.slice(p),a.input.selectionStart=a.input.selectionEnd=l+c+1}a.render()},this.input.onkeyup=function(t){a._value=a.input.value,requestAnimationFrame(function(){return a.render()})},window.addEventListener("keydown",function(t){switch(t.which){case 83:(t.ctrlKey||t.metaKey)&&(t.preventDefault(),a.togglePreview());break;case 90:(t.ctrlKey||t.metaKey)&&(t.preventDefault(),t.shiftKey?a.redo():o.length&&a.undo());break;case 88:case 89:(t.ctrlKey||t.metaKey)&&(t.preventDefault(),o.length&&(console.log("undo"),a.undo()))}})};r.prototype.undo=function(){if(o.length){var t=o.pop();s.push(t),o.length&&this.input.value===t?this.undo():this.input.value=t,0===o.length&&o.push(t),this.render()}},r.prototype.redo=function(){if(s.length){var t=s.pop();o.push(t),s.length&&this.input.value===t?this.redo():this.input.value=t,this.render()}},r.prototype.render=function(){var t=this.input.value;a.postMessage({type:"highlight",data:t})},r.prototype.togglePreview=function(){if(""===this.preview.style.display)this.preview.style.display="none",this.previewButton.classList.remove("black"),this.previewButtonIcon.classList.add("fi-eye"),this.previewButtonIcon.classList.remove("fi-page-edit"),this.input.focus();else{var t=l.input.value;this.preview.src="",this.preview.src="data:text/html;charset=utf-8,"+encodeURIComponent(t),this.preview.style.display="",this.previewButtonIcon.classList.remove("fi-eye"),this.previewButtonIcon.classList.add("fi-page-edit"),this.previewButton.classList.add("black")}};var l=new r;a.addEventListener("message",function(t){var e=t.data,i=e.type,n=e.data;"highlight"===i&&requestAnimationFrame(function(){l.output.innerHTML=n,l.input.style.height=l.output.clientHeight+"px",l.input.scrollTop=0})}),i(document.body,l),document.addEventListener("DOMContentLoaded",function(){FastClick.attach(document.body)},!1)}();